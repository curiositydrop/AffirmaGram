<!-- Save as fanwall.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fan Wall | Venomous Thorn</title>
  <link href="https://fonts.googleapis.com/css2?family=Metal+Mania&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/base.css">
</head>
<body data-page="fanwall">
  <!-- Falling skulls -->
  <div id="skullContainer"></div>
  <script>
    (function () {
      const skullContainer = document.getElementById("skullContainer");
      if (!skullContainer) return;
      const iconCount = 12;
      const icons = [{symbol:"üíÄ"},{symbol:"‚ò†Ô∏è"},{symbol:""}];
      for (let i=0;i<iconCount;i++){
        const el = document.createElement("div");
        el.className = "skull";
        el.textContent = icons[Math.floor(Math.random()*icons.length)].symbol;
        el.style.left = Math.random()*100 + "vw";
        el.style.animationDuration = (6 + Math.random()*6) + "s";
        el.style.fontSize = (20 + Math.random()*30) + "px";
        el.style.top = -Math.random()*100 + "px";
        skullContainer.appendChild(el);
      }
    })();
  </script>

  <!-- Shared header include -->
  <div data-include="partials/header.html" class="include include-header"></div>

  <!-- Page content -->
  <main class="page-shell">
    <section class="section">
      <h2>Fan Wall</h2>
      <p>Drop us a message or a show photo and we‚Äôll feature our favorites here.</p>

      <form id="fanForm" class="fan-form">
  <input type="text" name="name" placeholder="Your Name" required>

  <textarea name="message" rows="5" placeholder="Your message to the band" required></textarea>

  <input type="color" name="color" value="#32CD32" title="Choose text color">

  <input type="url" name="image_url" placeholder="Link to a photo (optional)">

  <button type="submit" class="btn">Post to Fan Wall</button>

  <p class="form-note">
    By submitting, you allow us to display your message (and linked photo) on this page.
  </p>

  <p id="fanStatus" class="status"></p>
</form>

<!-- Fan Wall Display Area -->
<div class="graffiti-wall"></div>
      <script>
  // TEMP test: should show a tilted green ‚ÄúTEST‚Äù note on the wall
  const stage = document.querySelector('.graffiti-wall');
  const el = document.createElement('div');
  el.className = 'graffiti-post';
  el.style.color = '#32CD32';
  el.style.transform = 'rotate(-7deg)';
  el.style.left = '24px';
  el.style.top = '20px';
  el.innerHTML = '<strong>TEST</strong><p>If you see this, CSS/HTML is fine.</p>';
  stage.appendChild(el);
</script>
    </section>
  </main>

  <!-- Shared footer include -->
  <div data-include="partials/footer.html" class="include include-footer"></div>

  <!-- Firebase config (your keys) -->

  <!-- Firebase + Fan Wall (mask + instant-post + graffiti layout) -->
<!-- Firebase config object -->
<script src="js/firebase-config.js"></script>

<!-- Fan Wall (single, final script) -->
<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
  import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, onSnapshot }
    from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

  const statusEl = document.getElementById('fanStatus');
  const stage = document.querySelector('.graffiti-wall');
  const form  = document.getElementById('fanForm');

  // tiny helper
  const say = (m,c) => { if(statusEl){ statusEl.textContent=m; if(c) statusEl.style.color=c; } };
  if (!window.FB_CONFIG) { say('FB_CONFIG missing (js/firebase-config.js not loaded).','orange'); }

  // init
  const app = initializeApp(window.FB_CONFIG);
  const db  = getFirestore(app);

  // mask bad words
  function censor(text){
    const map = {
      "fuck":"f*#k","fucking":"f*#king","shit":"sh!t","bitch":"b!tch","asshole":"a**hole",
      "dick":"d*ck","pussy":"p*ssy","cunt":"c#+*","bastard":"b*stard","cock":"c*ck",
      "cum":"c*m","twat":"tw*t","prick":"pr*ck","wanker":"w*nker","slut":"sl*t","whore":"wh*re",
      "nigger":"n*****","nigga":"n****","fag":"f*g","faggot":"f*ggot","spic":"sp*c","chink":"ch*nk","kike":"k*ke",
      "retard":"r*tard"
    };
    let s = String(text||'');
    for (const w in map) s = s.replace(new RegExp(`\\b${w}\\b`, 'gi'), map[w]);
    return s;
  }
  const esc = t => String(t||'').replace(/</g,'&lt;');
  const hex = h => /^#([0-9A-F]{6})$/i.test(h);

  // submit -> save instantly
  form?.addEventListener('submit', async (e)=>{
    e.preventDefault();
    try{
      const colorPick = (form.color?.value || '#32CD32').trim();
      await addDoc(collection(db,'fanwall'),{
        name:    censor(form.name.value.trim()),
        message: censor(form.message.value.trim()),
        image_url: (form.image_url.value||'').trim(),
        color: hex(colorPick) ? colorPick : '#32CD32',
        createdAt: serverTimestamp(),
        approved: true
      });
      say('Thanks! Your post is live.','#2ecc71');
      form.reset();
    }catch(err){
      console.error(err);
      say('Couldn‚Äôt send right now. Try again later.','tomato');
    }
  });

  // render one graffiti note
  function render(docSnap){
    const d = docSnap.data();
    if (!d || d.approved !== true) return;
    const el = document.createElement('div');
    el.className = 'graffiti-post';
    el.style.color = d.color || '#32CD32';
    el.innerHTML = `
      <strong>${esc(d.name||'Fan')}</strong>
      <p style="margin:6px 0 8px 0;">${esc(d.message||'')}</p>
      ${d.image_url ? `<a href="${esc(d.image_url)}" target="_blank" rel="noopener">
        <img src="${esc(d.image_url)}" alt="fan photo">
      </a>` : ''}
    `;
    stage.appendChild(el); // append first so it has size
    const angle = (Math.random()*30-15).toFixed(1);
    el.style.transform = `rotate(${angle}deg)`;
    const pad=16, maxL=Math.max(0, stage.clientWidth - el.offsetWidth - pad), maxT=Math.max(0, stage.clientHeight - el.offsetHeight - pad);
    el.style.left = `${Math.floor(Math.random()*(maxL+1))}px`;
    el.style.top  = `${Math.floor(Math.random()*(maxT+1))}px`;
    el.style.zIndex = String(10 + Math.floor(Math.random()*90));
  }

  // live stream
  const q = query(collection(db,'fanwall'), orderBy('createdAt','desc'));
  onSnapshot(q, (snap)=>{
    stage.innerHTML = '';
    say(`Listening‚Ä¶ ${snap.size} posts`, '#aaa');
    snap.forEach(render);
  });
</script>
  <!-- includes + site logic -->
  <script src="js/includes.js"></script>
  <script src="js/site.js"></script>
</body>
</html>
